<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="google-adsense-account" content="ca-pub-5488141368125579" />
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5488141368125579"
     crossorigin="anonymous"></script>
  <title>ê½ƒì„ ë§Œì§€ëŠ” ëˆ„ë‚˜ê°€ ë„ì™€ë“œë¦¼</title>
  <style>
    :root{
      /* ë°ì€ ì›í†¤ */
      --bg:#f4f5f7;

      /* ì¹´ë“œ/í…ìŠ¤íŠ¸ */
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;

      /* ë¼ì¸/ê·¸ë¦¼ì */
      --line:#e5e7eb;
      --ink:#111827;
      --shadow: 0 10px 30px rgba(15, 23, 42, .08);

      /* í¬ì¸íŠ¸(ê·¸ë¦°) */
      --accent:#22c55e; /* green */
      --accentDark:#16a34a;

      --radius: 18px;
      --pad: 18px;
      --max: 760px;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo","Noto Sans KR","Malgun Gothic", sans-serif;
      background: var(--bg);          /* âœ… ê·¸ë¼ë°ì´ì…˜ ì œê±° */
      color:var(--text);
      line-height:1.45;
    }

    .topnav{
      display:flex; flex-wrap:wrap; gap:10px;
      padding: 6px 2px 14px;
      align-items:center;
      font-size:12px;
      color: var(--muted);
    }
    .topnav a{
      color: var(--muted);
      text-decoration:none;
      padding:6px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      background:#fff;
    }
    .topnav a:hover{color: var(--text); border-color: var(--accent);}
    .toneHandle{
      margin-top: 16px;
      text-align:center;
      font-size:14px;
      font-weight:900;
      letter-spacing:.2px;
      color:#334155;
    }
    .toneHandle a{
      color: inherit;
      text-decoration:none;
    }
    .toneHandle a:hover{
      text-decoration:underline;
      text-underline-offset:3px;
    }
    .topInfoPanel{
      display:none;
      margin: 0 0 14px;
      border:1px solid var(--line);
      border-radius: 16px;
      background:#fff;
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .topInfoPanel.active{display:block;}
    .topInfoHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      margin-bottom:8px;
    }
    .topInfoHead h2{
      margin:0;
      font-size:16px;
      letter-spacing:-.2px;
    }
    .topInfoBody p{
      margin:0 0 8px;
      font-size:14px;
      color:var(--text);
    }
    .topInfoBody p:last-child{margin-bottom:0;}

    .wrap{max-width:var(--max); margin:0 auto; padding:24px 16px 60px;}

    .card{
      border:1px solid var(--line);
      border-radius:var(--radius);
      background: var(--card);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .hd{
      padding:14px var(--pad);
      border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      background: #fff;
    }

    .hd h1, .hd h2{margin:0; font-size:16px; letter-spacing:-.2px; color: var(--text);}

    .bd{padding: var(--pad);}

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border:1px solid var(--line); border-radius:999px;
      color:var(--muted); font-size:12px;
      background: #fff;
      user-select:none;
      white-space:nowrap;
    }

    .muted{color:var(--muted)}

    .hero{
      padding:22px 18px;
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: #fff;
    }

    .hero h1{
      font-size:22px;
      margin:0 0 8px;
      letter-spacing:-.4px;
      font-weight:900;
      color:var(--text);
    }

    .hero p{margin:0 0 10px; color:var(--muted); font-size:14px;}

    .hero .mini{
      margin-top:10px;
      font-size:13px;
      color: var(--text);
      opacity:.9;
    }

    .btnrow{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px;}

    button{
      appearance:none;
      border:1px solid var(--accent);
      background: var(--accent);
      color: #fff;
      padding: 12px 14px;
      border-radius: 14px;
      cursor:pointer;
      font-weight:800;
      letter-spacing:-.1px;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
    }
    button:hover{transform: translateY(-1px); background: var(--accentDark); border-color: var(--accentDark);}

    button.secondary{
      border:1px solid var(--line);
      background: #fff;
      color: var(--text);
      font-weight:800;
    }
    button.secondary:hover{background:#f8fafc; border-color:#d1d5db;}

    .screen{display:none;}
    .screen.active{display:block;}

    .progressWrap{
      margin: 0 0 14px;
      padding: 10px 12px;
      border:1px solid var(--line);
      border-radius: 14px;
      background: #fff;
    }

    .progressTop{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      font-size:12px; color:var(--muted);
      margin-bottom:8px;
      font-weight:700;
    }

    .bar{
      height:10px;
      border-radius:999px;
      background: #eef2f7;
      overflow:hidden;
      border:1px solid #e5e7eb;
    }

    .bar > div{
      height:100%;
      width:0%;
      background: var(--accent); /* âœ… ê·¸ë¦° */
      transition: width .25s ease;
    }

    /* âœ… Q í°íŠ¸(ì‚¬ì§„ ëŠë‚Œ: êµµê³  í¬ê²Œ, ê°€ìš´ë°) */
    .q{
      margin: 6px 0 10px;
      font-size: 24px;
      line-height: 1.25;
      letter-spacing: -0.6px;
      font-weight: 900;
      text-align:center;
      color: var(--text);
    }

    .sub{
      margin:0 0 16px;
      color:var(--muted);
      font-size:13px;
      text-align:center;
      font-weight:650;
    }

    .options{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }

    /* âœ… ABëŠ” í•­ìƒ 2ì¹¸(í°ì—ì„œë„) */
    .options.two{
      grid-template-columns: 1fr 1fr;
    }

    @media (max-width: 360px){
      .options.two{ grid-template-columns: 1fr; } /* ë„ˆë¬´ ì¢ìœ¼ë©´ 1ì¹¸ */
    }

    /* âœ… ì„ íƒ ë°•ìŠ¤: ê¸°ë³¸ í°ìƒ‰, ë‘êº¼ìš´ í…Œë‘ë¦¬, ê·¸ë¦¼ì */
    .opt{
      border:2px solid var(--ink);
      background: #fff;
      padding:16px 14px;
      border-radius: 18px;
      cursor:pointer;
      transition: transform .08s ease, border-color .15s ease, background .15s ease, color .15s ease;
      display:flex;
      align-items:flex-start;
      gap:10px;

      /* ì‚¬ì§„ì²˜ëŸ¼ ì‚´ì§ ëœ¬ ëŠë‚Œ */
      box-shadow: 0 8px 0 rgba(17,24,39,.10);
    }

    .opt:hover{transform: translateY(-1px); border-color: var(--accent);}

    /* âœ… ì„ íƒ í›„ ê·¸ë¦° */
    .opt[data-selected="true"]{
      border-color: var(--accent);
      background: var(--accent);
      color:#fff;
    }

    .opt .title{
      font-weight: 900;
      letter-spacing:-.2px;
      color: inherit;
      font-size: 15px;
    }

    .opt .desc{
      font-size:12px;
      color: var(--muted);
      margin-top:6px;
      font-weight:650;
    }

    .opt[data-selected="true"] .desc{
      color: rgba(255,255,255,.92);
    }

    /* âœ… AB ë°•ìŠ¤ ìŠ¤íƒ€ì¼ (A./B. ë¼ë²¨ í¬ê²Œ) */
    .opt.abOpt{
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align:center;
      padding:18px 14px;
      min-height: 120px;
      gap:8px;
    }

    .abBadge{
      font-weight: 1000;
      font-size: 22px;
      line-height: 1;
      letter-spacing:-.2px;
      color: inherit;
    }

    .abTitle{
      font-weight: 950;
      font-size: 16px;
      letter-spacing:-.3px;
      color: inherit;
    }

    .abDesc{
      font-size:12px;
      font-weight:700;
      color: var(--muted);
    }
    .opt[data-selected="true"] .abDesc{
      color: rgba(255,255,255,.92);
    }

    .footnote{margin-top:12px; font-size:12px; color:var(--muted); font-weight:600;}
    .trustline{
      margin-top:8px;
      font-size:12px;
      color:var(--text);
      font-weight:800;
    }

    .box{
      border:1px solid var(--line);
      background: #fff;
      border-radius: 16px;
      padding: 14px;
      margin-top: 12px;
    }

    .box h3{margin:0 0 8px; font-size:14px; font-weight:900; letter-spacing:-.2px;}
    .top3{display:grid; gap:10px;}
    .topItem{
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff;
      padding:12px;
      font-weight:900;
      font-size:15px;
      letter-spacing:-.2px;
    }
    .topItem small{
      display:block;
      margin-top:4px;
      font-size:12px;
      color:var(--muted);
      font-weight:700;
    }
    .priceRow{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:8px;
    }
    .priceBadge{
      border:1px solid var(--line);
      border-radius:999px;
      padding:6px 10px;
      background:#f8fafc;
      font-size:12px;
      font-weight:900;
      color:var(--text);
    }
    details.explain{
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px 12px;
      background:#fff;
    }
    details.explain summary{
      cursor:pointer;
      font-weight:900;
      font-size:13px;
      color:var(--text);
      list-style:none;
    }
    details.explain summary::-webkit-details-marker{display:none;}
    details.explain p{
      margin:8px 0 0;
      font-size:13px;
      color:var(--muted);
      font-weight:700;
    }

    .chips{display:flex; flex-wrap:wrap; gap:8px;}
    .chip{
      font-size:12px; color: var(--text);
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--line);
      background: #f8fafc;
      font-weight:800;
    }

    .samplePhoto{
      margin: 0 0 10px;
      border:1px solid var(--line);
      border-radius: 14px;
      overflow: hidden;
      background: #f8fafc;
    }
    .samplePhoto img{
      display:block;
      width:100%;
      height:220px;
      object-fit:contain;
      object-position:center;
      background:#fff;
    }
    .samplePhoto .cap{
      padding:8px 10px;
      font-size:12px;
      color:var(--muted);
      font-weight:700;
      border-top:1px solid var(--line);
      background:#fff;
    }
    .samplePhoto .title{
      padding:10px 12px;
      font-size:13px;
      color:var(--text);
      font-weight:900;
      border-bottom:1px solid var(--line);
      background:#f8fafc;
    }

    .palette{
      margin-top:10px;
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:8px;
    }
    .swatch{
      border:1px solid var(--line);
      border-radius:12px;
      overflow:hidden;
      background:#fff;
    }
    .swatchColor{
      height:34px;
      border-bottom:1px solid var(--line);
    }
    .swatchMeta{
      padding:6px 8px;
      font-size:11px;
      color:var(--text);
      font-weight:800;
      text-align:center;
      letter-spacing:-.1px;
    }

    .list{margin:8px 0 0; padding-left: 18px; font-size:13px; color: var(--text); font-weight:650;}
    .list li{margin:4px 0;}

    .toast{
      position: fixed; left: 50%; bottom: 18px; transform: translateX(-50%);
      background: rgba(17,24,39,.92);
      border: 1px solid rgba(255,255,255,.18);
      color: #fff;
      padding: 10px 12px;
      border-radius: 14px;
      box-shadow: var(--shadow);
      font-size: 13px;
      opacity: 0; pointer-events:none;
      transition: opacity .15s ease;
      z-index: 9999;
      font-weight:700;
    }
    .toast.show{opacity:1;}

    .divider{height:1px; background: #eef2f7; margin:12px 0;}

    .section{
      margin-top:16px;
      border:1px solid var(--line);
      border-radius:var(--radius);
      background: var(--card);
      box-shadow: var(--shadow);
      padding: var(--pad);
    }
    .section h2{margin:0 0 10px; font-size:18px; letter-spacing:-.2px;}
    .section p{margin:0 0 10px; font-size:14px;}
    .section .small{font-size:12px; color: var(--muted);}

    .twoCol{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media (min-width: 640px){
      .twoCol{grid-template-columns: 1fr 1fr;}
    }

    .ctaPro{
      border: 1px dashed rgba(34,197,94,.55);
      background: rgba(34,197,94,.06);
    }

    /* ====== Start Poster (Landing) ====== */
    :root{
      --startBg: url('./assets/bg-wreath.png');
    }

    #screenStart .card{
      /* ì²« í™”ë©´ì€ ì¹´ë“œ ëŠë‚Œ ì•½í•˜ê²Œ + í¬ìŠ¤í„° ëŠë‚Œ */
      border: none;
      box-shadow: none;
      background: transparent;
    }

    .startPoster{
      position: relative;
      min-height: calc(100vh - 48px);
      border-radius: 22px;
      overflow: hidden;
      border: 1px solid rgba(229,231,235,.6);
      box-shadow: 0 18px 50px rgba(15, 23, 42, .10);
      background: #f8fafc;
    }

    /* ë°°ê²½ ì´ë¯¸ì§€ + ì˜¤ë²„ë ˆì´ */
    .startPoster::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(60% 40% at 50% 8%, rgba(255,255,255,.9), rgba(255,255,255,0) 70%),
        linear-gradient(180deg, #ffffff 0%, #f3f4f6 60%, #eef2f7 100%);
    }

    .startPoster::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(35% 28% at 50% 40%, rgba(255,255,255,0), rgba(255,255,255,.95) 70%);
    }

    .startInner{
      position: relative;
      z-index: 1;
      padding: 22px 18px 18px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .startTopRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .startBadge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.85);
      border: 1px solid rgba(255,255,255,.65);
      font-size: 12px;
      font-weight: 800;
      color: #111827;
    }

    .startTitle{
      text-align:center;
      padding-top: 6px;
    }

    .startTitle h1{
      margin: 8px 0 6px;
      font-size: 28px;
      line-height: 1.12;
      letter-spacing: -0.8px;
      font-weight: 950;
      color: #0b0f14;
      text-shadow: 0 1px 0 rgba(255,255,255,.35);
    }

    .startTitle p{
      margin: 0;
      font-size: 14px;
      font-weight: 750;
      color: rgba(17,24,39,.85);
    }

    .startSlider{
      margin-top: 10px;
      display: flex;
      justify-content: center;
    }
    .startSliderWrap{
      position: relative;
      width: min(100%, 580px);
      display:flex;
      flex-direction: column;
      align-items:center;
      justify-content:center;
      padding: 0 116px;
      gap: 12px;
    }
    .slideFrame{
      position: relative;
      width: min(100%, 340px);
      aspect-ratio: 4 / 3;
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(226,232,240,.95);
      background: #fff;
      box-shadow: 0 16px 28px rgba(15, 23, 42, .14);
    }
    .slideItem{
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      object-position: center;
      opacity: 0;
      transition: opacity .35s ease;
      background: #fff;
    }
    .slideItem.active{
      opacity: 1;
    }
    .speechBubble{
      position:absolute;
      width: 168px;
      height: 96px;
      border-radius:999px;
      border:2px solid rgba(17,24,39,.2);
      background:#ffffff;
      color:#111827;
      font-size:14px;
      font-weight:900;
      line-height:1.2;
      letter-spacing:-.2px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:10px;
      box-shadow: 0 10px 20px rgba(15,23,42,.16);
    }
    .speechBubble::after{
      content:"";
      position:absolute;
      width: 14px;
      height: 14px;
      background:#fff;
      border-right:2px solid rgba(17,24,39,.2);
      border-bottom:2px solid rgba(17,24,39,.2);
      transform: rotate(45deg);
    }
    .speechOwner{
      left: 0;
      top: 14px;
    }
    .speechOwner::after{
      right: 12px;
      bottom: 10px;
    }
    .speechNo{
      right: 0;
      top: 0;
    }
    .speechNo::after{
      left: 14px;
      bottom: 8px;
    }
    .speechAny{
      right: 6px;
      bottom: 2px;
    }
    .speechAny::after{
      left: 18px;
      top: 12px;
    }
    .startBubbleRow{
      display:flex;
      width:100%;
      justify-content:space-between;
      gap:8px;
    }
    .startBubbleRow .speechBubble{
      position:static;
    }
    .startBubbleRow .speechBubble::after{display:none;}
    .speechOwner,
    .speechNo,
    .speechAny{
      display:none;
    }

    .startCta{
      margin-top: 8px;
      display:flex;
      flex-direction: column;
      gap: 10px;
    }

    .startCta button{
      width: 100%;
      padding: 14px 14px;
      border-radius: 16px;
      font-size: 16px;
    }
    .startGuide{
      color:#111827;
      background:rgba(255,255,255,.9);
      border:1px solid rgba(255,255,255,.75);
      border-radius:16px;
      padding:10px 12px;
    }
    .startGuideTitle{
      margin:0 0 6px;
      font-size:13px;
      font-weight:900;
      text-align:left;
    }
    .startGuideItem{
      margin:0 0 4px;
      font-size:13px;
      font-weight:760;
      line-height:1.35;
      text-align:left;
    }
    .startGuideItem:last-child{margin-bottom:0;}
    .examplePreviewLink{
      appearance:none;
      border:none;
      background:none;
      color:#0f172a;
      font-size:14px;
      font-weight:850;
      text-decoration:underline;
      text-underline-offset: 3px;
      padding:2px 0 0;
      margin: 0 auto;
      cursor:pointer;
      width:auto;
    }
    .examplePreviewLink:hover{
      transform:none;
      background:none;
      border:none;
      color:#166534;
    }

    .startMeta{
      text-align: center;
      font-size: 12px;
      font-weight: 750;
      color: rgba(255,255,255,.85);
    }
    .startBrand{
      margin-top: 10px;
      text-align: center;
      font-size: 13px;
      font-weight: 900;
      color: rgba(255,255,255,.92);
    }

    @media (max-width: 420px){
      .startTitle h1{ font-size: 26px; }
      .startSliderWrap{
        width:100%;
        padding:0;
        flex-direction:column;
        gap:10px;
      }
      .speechBubble{
        width: 118px;
        height: 74px;
        border-radius:999px;
        font-size:12px;
      }
      .speechBubble::after{display:none;}
    }

    @media (max-width: 360px){
      .slideFrame{
        border-radius: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <section class="screen active" id="screenStart">
      <div class="startPoster">
        <div class="startInner">
          <div class="startTopRow">
            <div class="startBadge">ğŸŒ· ê½ƒì„ ë§Œì§€ëŠ” ëˆ„ë‚˜</div>
            <div class="startBadge">ë¬´ë£Œ í…ŒìŠ¤íŠ¸</div>
          </div>

          <div class="startTitle">
            <h1>ì—¬ì¹œ ê½ƒì„ ë¬¼ "ì˜ˆì˜ê²Œìš”"<br/><br/>30ì´ˆë§Œì— ì¶”ì²œ</h1>
            <p>ì·¨í–¥ ëª°ë¼ë„ ëˆ„ë‚˜ê°€ ë„ì™€ì¤„ê²Œ.</p>
          </div>

          <div class="startSlider">
            <div class="startSliderWrap">
              <div class="speechBubble speechOwner">10ë…„ì°¨<br/>ê½ƒì§‘ì‚¬ì¥</div>
              <div class="slideFrame" id="startSlideFrame">
                <img class="slideItem active" src="./image/rose.png" alt="ëŒ€í‘œ ê½ƒ ì¥ë¯¸" loading="eager" />
                <img class="slideItem" src="./image/calla.png" alt="ëŒ€í‘œ ê½ƒ ì¹´ë¼" loading="lazy" />
                <img class="slideItem" src="./image/gerbera.png" alt="ëŒ€í‘œ ê½ƒ ê±°ë² ë¼" loading="lazy" />
                <img class="slideItem" src="./image/lisianthus.png" alt="ëŒ€í‘œ ê½ƒ ë¦¬ì‹œì•ˆì…”ìŠ¤" loading="lazy" />
                <img class="slideItem" src="./image/ranunculus.png" alt="ëŒ€í‘œ ê½ƒ ë¼ë„Œí˜ëŸ¬ìŠ¤" loading="lazy" />
                <img class="slideItem" src="./image/tulip.png" alt="ëŒ€í‘œ ê½ƒ íŠ¤ë¦½" loading="lazy" />
              </div>
              <div class="speechBubble speechNo">ì‚¬ì§„ ì—…ë¡œë“œ<br/>í•„ìš”ì—†ìŒ</div>
              <div class="speechBubble speechAny">ì£¼ë¬¸ ë¬¸ì¥<br/>ë³µë¶™ ì œê³µ</div>
              <div class="startBubbleRow" aria-hidden="true">
                <div class="speechBubble">10ë…„ì°¨<br/>ê½ƒì§‘ì‚¬ì¥</div>
                <div class="speechBubble">ì‚¬ì§„ ì—…ë¡œë“œ<br/>í•„ìš”ì—†ìŒ</div>
                <div class="speechBubble">ì£¼ë¬¸ ë¬¸ì¥<br/>ë³µë¶™ ì œê³µ</div>
              </div>
            </div>
          </div>

          <div class="startCta">
            <div class="startGuide">
              <p class="startGuideTitle">ë¬´ë£Œë¡œ ë°›ëŠ” ê²°ê³¼</p>
              <p class="startGuideItem">âœ… ëŒ€í‘œ ê½ƒ 1ì†¡ì´ + ê½ƒ ì´ë¦„</p>
              <p class="startGuideItem">âœ… ê½ƒì§‘ ì „ë‹¬ìš© í†¤/ë¬´ë“œ ê°€ì´ë“œ</p>
              <p class="startGuideItem">âœ… ê½ƒì§‘ DM ë³µë¶™ ë¬¸ì¥ 1ê°œ</p>
              <p class="startGuideItem">âœ… ê·¸ë…€ì—ê²Œ ë³´ë‚´ëŠ” ë©˜íŠ¸ 3ê°œ(ë³µì‚¬)</p>
            </div>
            <button id="btnStart" type="button">30ì´ˆë¡œ ì¶”ì²œë°›ê¸°</button>
            <button class="secondary" id="btnShareSite" type="button">ë‚¨ì¹œì—ê²Œ ë³´ë‚´ê¸°(ë§í¬ ë³µì‚¬)</button>
            <button id="btnLoadExample" class="examplePreviewLink" type="button">ì˜ˆì‹œ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°</button>
            <div class="startMeta">â€» ê²°ê³¼ì—ì„œ ë©˜íŠ¸ ë³µì‚¬ + ë§í¬ ê³µìœ  ê°€ëŠ¥</div>
            <div class="startBrand">Â© TONE ART</div>
          </div>
        </div>
      </div>
    </section>

    <section class="screen" id="screenQuiz">
      <div class="card">
        <div class="hd">
          <h2 id="quizTitle">ì„ íƒ</h2>
          <span class="pill" id="quizPill">ì¹œí•œ ëˆ„ë‚˜ ëª¨ë“œ</span>
        </div>
        <div class="bd">
          <div class="progressWrap">
            <div class="progressTop">
              <span id="stepText">1/6</span>
              <span id="stepHint">ì„ íƒí•˜ë©´ ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°€ìš”</span>
            </div>
            <div class="bar"><div id="barFill"></div></div>
          </div>

          <h2 class="q" id="qText">Q. ì§ˆë¬¸</h2>
          <p class="sub" id="qSub">ì„¤ëª…</p>

          <div class="options" id="options"></div>

          <div class="btnrow">
            <button class="secondary" id="btnBack" type="button">ì´ì „</button>
            <button id="btnNext" type="button" style="display:none;">ë‹¤ìŒ</button>
            <button class="secondary" id="btnRestart" type="button">ì²˜ìŒìœ¼ë¡œ</button>
          </div>

          <div class="footnote" id="quizFootnote"></div>
        </div>
      </div>
    </section>

    <section class="screen" id="screenResult">
      <div class="card">
        <div class="hd">
          <h2>ë¬´ë£Œ ê²°ê³¼</h2>
          <span class="pill">ê½ƒ+ë©˜íŠ¸ ì™„ì„±</span>
        </div>
        <div class="bd" id="resultArea"></div>
      </div>
    </section>

    <div class="toneHandle"><a href="http://instargram.com/tone_art" target="_blank" rel="noopener noreferrer">@tone_art</a></div>
    <nav class="topnav" aria-label="ì‚¬ì´íŠ¸ íƒìƒ‰">
      <a href="#" data-info="about">ì†Œê°œ</a>
      <a href="#" data-info="how">ì´ìš©ë°©ë²•</a>
      <a href="#" data-info="guide">ê°€ì´ë“œ</a>
      <a href="#" data-info="faq">FAQ</a>
      <a href="#" data-info="policy">ì •ì±…</a>
      <a href="#" data-info="contact">ë¬¸ì˜</a>
    </nav>
    <section id="topInfoPanel" class="topInfoPanel" aria-live="polite">
      <div class="topInfoHead">
        <h2 id="topInfoTitle">ì•ˆë‚´</h2>
        <button class="secondary" id="btnCloseTopInfo" type="button">ë‹«ê¸°</button>
      </div>
      <div id="topInfoBody" class="topInfoBody"></div>
    </section>

  </div>

  <div id="toast" class="toast">ë³µì‚¬í–ˆì–´!</div>

  <script>
    const $ = (id) => document.getElementById(id);

    function initStartSlider(){
      const frame = $('startSlideFrame');
      if(!frame) return;
      const slides = Array.from(frame.querySelectorAll('.slideItem'));
      if(slides.length < 2) return;

      let idx = 0;
      setInterval(()=>{
        slides[idx].classList.remove('active');
        idx = (idx + 1) % slides.length;
        slides[idx].classList.add('active');
      }, 1000);
    }

    function escapeHtml(value) {
      return String(value)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    function toast(msg){
      const el = $('toast');
      el.textContent = msg;
      el.classList.add('show');
      setTimeout(()=> el.classList.remove('show'), 1200);
    }

    async function copyText(text){
      try{
        if(navigator.clipboard && window.isSecureContext){
          await navigator.clipboard.writeText(text);
          return true;
        }
      }catch(e){}
      try{
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.style.position = 'fixed';
        ta.style.left = '-9999px';
        ta.style.top = '0';
        document.body.appendChild(ta);
        ta.focus();
        ta.select();
        const ok = document.execCommand('copy');
        document.body.removeChild(ta);
        return ok;
      }catch(e){
        return false;
      }
    }

    function base64UrlEncode(obj){
      const json = JSON.stringify(obj);
      const bytes = new TextEncoder().encode(json);
      let bin = '';
      for (const b of bytes) bin += String.fromCharCode(b);
      const b64 = btoa(bin).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
      return b64;
    }

    function base64UrlDecode(str){
      const b64 = str.replace(/-/g,'+').replace(/_/g,'/');
      const pad = b64 + '==='.slice((b64.length + 3) % 4);
      const bin = atob(pad);
      const bytes = Uint8Array.from(bin, c => c.charCodeAt(0));
      const json = new TextDecoder().decode(bytes);
      return JSON.parse(json);
    }

    function showScreen(which){
      ['screenStart','screenQuiz','screenResult'].forEach(id=>{
        $(id).classList.toggle('active', id === which);
      });
      window.scrollTo({top:0, behavior:'smooth'});
    }

    const topInfoMap = {
      about: {
        title: 'ì†Œê°œ',
        lines: [
          'ì´ ì‚¬ì´íŠ¸ëŠ” ê½ƒ ì„ íƒì„ 30ì´ˆ ì§ˆë¬¸ìœ¼ë¡œ ì •ë¦¬í•´ì£¼ëŠ” ë¬´ë£Œ ê°€ì´ë“œì…ë‹ˆë‹¤.',
          'ê²°ê³¼ëŠ” ê½ƒì§‘ ì£¼ë¬¸ì— ë°”ë¡œ ì „ë‹¬í•  ìˆ˜ ìˆëŠ” í†¤/í¬ì¥/ë©˜íŠ¸ íŒíŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.'
        ]
      },
      how: {
        title: 'ì´ìš©ë°©ë²•',
        lines: [
          '1) ì§ˆë¬¸ì— ë‹µí•˜ê¸°: ê´€ê³„/ìƒí™©/ë¬´ë“œë¥¼ ê³ ë¦…ë‹ˆë‹¤.',
          '2) ê²°ê³¼ í™•ì¸: ê½ƒ ì¡°í•©ê³¼ ë©˜íŠ¸ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.',
          '3) ê½ƒì§‘ ì „ë‹¬: ë³µì‚¬í•œ ë¬¸ì¥ìœ¼ë¡œ ë¹ ë¥´ê²Œ ì£¼ë¬¸í•©ë‹ˆë‹¤.'
        ]
      },
      guide: {
        title: 'ê°€ì´ë“œ',
        lines: [
          'í•µì‹¬ì€ ë¬´ë“œ + í†¤ + ê¸ˆê¸° 3ê°€ì§€ë¥¼ í•¨ê»˜ ë§í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.',
          'í–¥/ì•Œë ˆë¥´ê¸°/í”¼í•˜ê³  ì‹¶ì€ ê½ƒì´ ìˆìœ¼ë©´ ë¨¼ì € ì•Œë ¤ì£¼ì„¸ìš”.'
        ]
      },
      faq: {
        title: 'FAQ',
        lines: [
          'Q. ê²°ê³¼ê°€ ë§¤ë²ˆ ê°™ë‚˜ìš”? A. ì„ íƒí•œ ì¡°ê±´ì— ë”°ë¼ ë‹¬ë¼ì§‘ë‹ˆë‹¤.',
          'Q. ë°”ë¡œ ì£¼ë¬¸ ê°€ëŠ¥í•œê°€ìš”? A. ë„¤, ì˜ˆì‚°/ì¬ê³ ì— ë§ê²Œ ë¯¸ì„¸ ì¡°ì •í•˜ë©´ ë©ë‹ˆë‹¤.'
        ]
      },
      policy: {
        title: 'ì •ì±…',
        lines: [
          'ê°œì¸ì •ë³´: ì…ë ¥ê°’ì€ ë¸Œë¼ìš°ì € ë‚´ì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤.',
          'ì •ì±… ë¬¸ì„œ: ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨, ì´ìš©ì•½ê´€ í˜ì´ì§€ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.'
        ]
      },
      contact: {
        title: 'ë¬¸ì˜',
        lines: [
          'í”¼ë“œë°±/ë¬¸ì˜ ë©”ì¼: tone_art@hanmail.net'
        ]
      }
    };

    function initTopInfoPanel(){
      const panel = $('topInfoPanel');
      const titleEl = $('topInfoTitle');
      const bodyEl = $('topInfoBody');
      const closeBtn = $('btnCloseTopInfo');
      if(!panel || !titleEl || !bodyEl) return;

      const links = Array.from(document.querySelectorAll('.topnav a[data-info]'));
      let openKey = '';

      const hidePanel = () => {
        panel.classList.remove('active');
        openKey = '';
      };

      links.forEach((link)=>{
        link.addEventListener('click', (e)=>{
          e.preventDefault();
          const key = link.dataset.info || '';
          const data = topInfoMap[key];
          if(!data) return;
          if(openKey === key){
            hidePanel();
            return;
          }
          titleEl.textContent = data.title;
          bodyEl.innerHTML = data.lines.map((line)=>`<p>${escapeHtml(line)}</p>`).join('');
          panel.classList.add('active');
          openKey = key;
        });
      });

      if(closeBtn){
        closeBtn.addEventListener('click', hidePanel);
      }
    }

    const steps = [
      {
        id:'relation',
        type:'single',
        title:'ëˆ„êµ¬ì—ê²Œ ì¤„ ê±°ì•¼?',
        sub:'ëˆ„êµ¬í•œí…Œ ì¤„ì§€ë§Œ ê³ ë¥´ë©´ ë¼.',
        options:[
          {value:'ì¸/ì†Œê°œíŒ…', title:'ì¸/ì†Œê°œíŒ…', desc:'ê°€ë³ê³  ì„¼ìŠ¤ ìˆê²Œ'},
          {value:'ì—¬ìì¹œêµ¬(ì—°ì¸)', title:'ì—¬ìì¹œêµ¬', desc:'ë‹¤ì •í•˜ê³  ì„¤ë ˆê²Œ'},
          {value:'ì•„ë‚´/ë°°ìš°ì', title:'ì•„ë‚´', desc:'ê³ ë§™ê³  ë“ ë“ í•˜ê²Œ'},
          {value:'ì¹œêµ¬/ë™ë£Œ', title:'ì¹œêµ¬/ì§ì¥ë™ë£Œ', desc:'í¸í•˜ê³  ê¹”ë”í•˜ê²Œ'}
        ]
      },
      {
        id:'occasion',
        type:'single',
        title:'ë¬´ìŠ¨ ì¼ë¡œ ì£¼ëŠ” ê±°ì•¼?',
        sub:'ì£¼ëŠ” ì´ìœ ë§Œ ê³ ë¥´ë©´ ë§ì¶°ì¤„ê²Œ.',
        options:[
          {value:'ìƒì¼/ê¸°ë…ì¼', title:'ìƒì¼/ê¸°ë…ì¼', desc:'íŠ¹ë³„í•œ ë‚  ê¸°ë¶„ ì¢‹ê²Œ ì¶•í•˜'},
          {value:'ì‚¬ê³¼(ë¯¸ì•ˆí•´)', title:'ë¯¸ì•ˆí•´ì„œ', desc:'ë¶€ë‹´ ì—†ì´ ì§„ì‹¬ ì „ë‹¬'},
          {value:'ì¶•í•˜(í•©ê²©/ìŠ¹ì§„/ìƒˆì¶œë°œ)', title:'í•©ê²©/ìŠ¹ì§„ ì¶•í•˜', desc:'ì‘ì›ê³¼ ì¶•í•˜ ì „ë‹¬'},
          {value:'ì²« ì„ ë¬¼', title:'ì²˜ìŒ ì£¼ëŠ” ê½ƒ', desc:'ì•ˆì „í•˜ê²Œ ì‹œì‘'},
          {value:'ê·¸ëƒ¥(ê³ ë§™ê³  ì‘ì›)', title:'ê·¸ëƒ¥ ê³ ë§ˆì›Œì„œ', desc:'í¸í•˜ê²Œ ë§ˆìŒ ì „ë‹¬'}
        ]
      },
      {
        id:'style',
        type:'single',
        title:'ê·¸ ì‚¬ëŒ ìŠ¤íƒ€ì¼ì€ ì–´ëŠ ìª½?',
        sub:'ë”± ë´¤ì„ ë•Œ ì–´ìš¸ë¦¬ëŠ” ìª½ ê³ ë¥´ë©´ ë¼.',
        options:[
          {value:'soft_feminine', title:'ì²­ìˆœ/ì—¬ë¦¬í•œ', desc:'ë§‘ê³  ë¶€ë“œëŸ¬ìš´ ë¶„ìœ„ê¸°'},
          {value:'romantic', title:'ëŸ¬ë¸”ë¦¬í•œ', desc:'ë‹¬ì½¤í•˜ê³  ì‚¬ë‘ìŠ¤ëŸ¬ìš´ ë¶„ìœ„ê¸°'},
          {value:'chic_elegant', title:'ì„¸ë ¨/ë„ì‹œì  Â· ìš°ì•„', desc:'ëª¨ë˜í•˜ê³  í’ˆê²© ìˆëŠ” ë¶„ìœ„ê¸°'},
          {value:'trendy', title:'íŠ¸ë Œë””/í™í•œ', desc:'ê°ê°ì ì´ê³  ì¿¨í•œ ë¶„ìœ„ê¸°'},
          {value:'minimal', title:'ë¯¸ë‹ˆë©€/ê¹”ë”í•œ', desc:'ë‹´ë°±í•˜ê³  ì ˆì œëœ ë¶„ìœ„ê¸°'}
        ]
      },
      {
        id:'palette',
        type:'single',
        title:'ìƒ‰ê°ì€ ë­ê°€ ë” ê·¸ë…€ ìŠ¤íƒ€ì¼?',
        sub:'ì˜·/ë„¤ì¼/ë°© í†¤ ë– ì˜¬ë¦¬ê³  ê³ ë¥´ë©´ ë¼.',
        options:[
          { value: 'white_green',   title: 'í™”ì´íŠ¸Â·ê·¸ë¦° ğŸ¤ğŸŒ¿', desc: 'ê¹”ë”/ì •ëˆ/ë¯¸ë‹ˆë©€' },
          { value: 'pink_peach',    title: 'í•‘í¬Â·í”¼ì¹˜ ğŸ©·ğŸ‘', desc: 'ë¶€ë“œëŸ½ê³  ëŸ¬ë¸”ë¦¬' },
          { value: 'lilac',         title: 'ì—°ë³´ë¼Â·ë¼ì¼ë½ ğŸ’œğŸ«§', desc: 'ì¿¨í•˜ê³  ê°ì„±' },
          { value: 'red_wine',      title: 'ë ˆë“œÂ·ë²„ê±´ë”” â¤ï¸ğŸ·', desc: 'ë¡œë§¨í‹±/í™•ì‹¤í•œ í¬ì¸íŠ¸' },
          { value: 'yellow_orange', title: 'ì˜ë¡œÂ·ì˜¤ë Œì§€ ğŸ’›ğŸ§¡', desc: 'ê¸°ë¶„ ì—…/ë°œë„' }
        ]
      },
      {
        id:'photoHabit',
        type:'single',
        title:'ì‚¬ì§„ ì°ëŠ” íƒ€ì…ì´ì•¼?',
        sub:'ì‚¬ì§„ë¹¨ ì¤‘ìš”í•˜ë©´ ë§ˆë¬´ë¦¬ë„ ë‹¬ë¼ì ¸. íƒ€ì…ë§Œ ê³¨ë¼ì¤˜.',
        options:[
          { value: 'sns_often', title: 'SNSì— ìì£¼ ì˜¬ë¦¼', desc: 'í”¼ë“œ/ìŠ¤í† ë¦¬ ìì£¼' },
          { value: 'sns_sometimes', title: 'ê°€ë” ì˜¬ë¦¼', desc: 'ê¸°ë…ì¼/íŠ¹ë³„í•œ ë‚ ' },
          { value: 'private_photo', title: 'ì°ê¸´ í•˜ëŠ”ë° ì˜¬ë¦¬ì§„ ì•ŠìŒ', desc: 'ê¸°ë¡ìš©/ê°œì¸ ì†Œì¥' },
          { value: 'no_photo', title: 'ì‚¬ì§„ ê´€ì‹¬ ì—†ìŒ', desc: 'ë°›ìœ¼ë©´ ë°”ë¡œ ë' }
        ]
      },
      {
        id:'cautions',
        type:'multi',
        title:'ì°¸ê³ í•´ì•¼ í•  ê²Œ ìˆì–´?',
        sub:'ìˆìœ¼ë©´ ì²´í¬í•˜ê³ , ì—†ìœ¼ë©´ â€œì—†ìŒâ€ ëˆ„ë¥´ë©´ ë¼. (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)',
        options:[
          {value:'scent_light', title:'í–¥ì€ ì•½í•œ ìª½ì´ ì¢‹ì•„ìš”', desc:'í–¥ ë¯¼ê°'},
          {value:'allergy_sensitive', title:'ì•Œë ˆë¥´ê¸°/ë¯¼ê°ì´ ìˆì–´ìš”', desc:'ê½ƒê°€ë£¨/í–¥ ìµœì†Œ'},
          {value:'no_rose', title:'ì¥ë¯¸ëŠ” ë‹¤ë¥¸ ê½ƒì´ë©´ ë” ì¢‹ì•„ìš”', desc:'ì·¨í–¥/ê¸°ì–µ'},
          {value:'clean_over_flashy', title:'í™”ë ¤í•¨ë³´ë‹¨ ê¹”ë”í•œ ê²Œ ì¢‹ì•„ìš”', desc:'í†¤ ì¤„ì´ë©´ ì•ˆì „'},
          {value:'none', title:'ì—†ìŒ', desc:'íŠ¹ë³„í•œ ì£¼ì˜ ì—†ìŒ'}
        ]
      }
    ];

    const allowedValues = steps.reduce((acc, step) => {
      acc[step.id] = new Set(step.options.map(o => o.value));
      return acc;
    }, {});

    function sanitizeLoadedState(raw){
      const normalized = {
        relation: null,
        occasion: null,
        palette: null,
        photoHabit: null,
        finish: null,
        brightness: null,
        style: null,
        cautions: []
      };

      if (!raw || typeof raw !== 'object') return normalized;

      const legacyStyleMap = {
        chic: 'chic_elegant',
        elegant: 'chic_elegant'
      };

      ['relation', 'occasion', 'palette', 'photoHabit', 'style'].forEach((key)=>{
        const value = raw[key];
        const resolved = (key === 'style' && legacyStyleMap[value]) ? legacyStyleMap[value] : value;
        normalized[key] = allowedValues[key].has(resolved) ? resolved : null;
      });

      const cautions = Array.isArray(raw.cautions) ? raw.cautions : [];
      const safeCautions = cautions.filter(v => allowedValues.cautions.has(v));
      if(safeCautions.includes('none')) normalized.cautions = ['none'];
      else normalized.cautions = safeCautions;

      return normalized;
    }

    const paletteByPersonality = {
      'ëŸ¬ë¸”ë¦¬': [
        { name:'Rose Quartz', hex:'#F7CAC9' },
        { name:'Peach Echo', hex:'#F7B39B' },
        { name:'Cream Tan', hex:'#F3E0BE' }
      ],
      'ì„¸ë ¨ë¨': [
        { name:'Cloud Dancer', hex:'#F0EEE9' },
        { name:'Harbor Mist', hex:'#BFC9C2' },
        { name:'Urban Chic', hex:'#464646' }
      ],
      'ê·€ì—¬ì›€': [
        { name:'Lemon Zest', hex:'#F9E547' },
        { name:'Bubblegum', hex:'#FF77A9' },
        { name:'Apricot', hex:'#FFB482' }
      ],
      'ë¯¸ë‹ˆë©€': [
        { name:'Snow White', hex:'#F8F7F2' },
        { name:'Silk Gray', hex:'#D9D9D6' },
        { name:'Sage Hint', hex:'#C9D4C5' }
      ],
      'ìš°ì•„í•¨': [
        { name:'Muted Blush', hex:'#D9A5A0' },
        { name:'Champagne', hex:'#F3E5C8' },
        { name:'Vintage Green', hex:'#708D81' }
      ],
      'í™œê¸°': [
        { name:'Sunflower', hex:'#FFD23F' },
        { name:'Orange Pop', hex:'#FF8C42' },
        { name:'Fresh Leaf', hex:'#7DBA3A' }
      ]
    };

    const bouquetPhotoByPersonality = {
      'ëŸ¬ë¸”ë¦¬': './image/rose.png',
      'ì„¸ë ¨ë¨': './image/calla.png',
      'ê·€ì—¬ì›€': './image/gerbera.png',
      'ë¯¸ë‹ˆë©€': './image/lisianthus.png',
      'ìš°ì•„í•¨': './image/lisianthus.png',
      'í™œê¸°': './image/tulip.png'
    };

    const flowerNameByPhotoKey = {
      rose: 'ì¥ë¯¸',
      calla: 'ì¹´ë¼',
      gerbera: 'ê±°ë² ë¼',
      lisianthus: 'ë¦¬ì‹œì•ˆì…”ìŠ¤',
      tulip: 'íŠ¤ë¦½',
      ranunculus: 'ë¼ë„Œí˜ëŸ¬ìŠ¤'
    };

    const flowerPhotoByName = {
      'ì¥ë¯¸': './image/rose.png',
      'íŠ¤ë¦½': './image/tulip.png',
      'ë¼ë„Œí˜ëŸ¬ìŠ¤': './image/ranunculus.png',
      'ë¦¬ì‹œì•ˆì…”ìŠ¤': './image/lisianthus.png',
      'ê±°ë² ë¼': './image/gerbera.png',
      'ì¹´ë¼': './image/calla.png'
    };

    function fallbackSampleImage(concept){
      const safe = escapeHtml(concept || 'ì¶”ì²œ ì»¨ì…‰');
      const svg = `
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="800">
  <defs>
    <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#dcfce7"/>
      <stop offset="100%" stop-color="#bbf7d0"/>
    </linearGradient>
  </defs>
  <rect width="1200" height="800" fill="url(#g)"/>
  <text x="50%" y="48%" text-anchor="middle" font-size="44" font-family="sans-serif" fill="#166534">ìƒ˜í”Œ ì‚¬ì§„ ì¤€ë¹„ì¤‘</text>
  <text x="50%" y="56%" text-anchor="middle" font-size="34" font-family="sans-serif" fill="#166534">${safe}</text>
</svg>`;
      return `data:image/svg+xml;charset=UTF-8,${encodeURIComponent(svg)}`;
    }

    function pickFlowerPhoto(mainList){
      for(const f of (mainList || [])){
        const key = Object.keys(flowerPhotoByName).find(k => f.includes(k));
        if(key) return flowerPhotoByName[key];
      }
      return null;
    }

    function pickConceptPreviewPhoto(personality){
      return bouquetPhotoByPersonality[personality]
        || './image/rose.png';
    }

    function pickConceptFlowerName(personality){
      const photo = pickConceptPreviewPhoto(personality);
      const file = (photo.split('/').pop() || '').split('.')[0];
      return flowerNameByPhotoKey[file] || 'ì¥ë¯¸';
    }

    const state = {
      relation:null,
      occasion:null,
      palette:null,
      photoHabit:null,
      finish:null,
      brightness:null,
      style:null,
      cautions:[]
    };

    function clearState(){
      state.relation = null;
      state.occasion = null;
      state.palette = null;
      state.photoHabit = null;
      state.finish = null;
      state.brightness = null;
      state.style = null;
      state.cautions = [];
    }

    let stepIdx = 0;
    function currentStep(){ return steps[stepIdx]; }

    function setAnswer(stepId, value){
      const step = steps.find(s => s.id === stepId);
      if(step && step.type === 'multi'){
        const current = Array.isArray(state[stepId]) ? [...state[stepId]] : [];
        const idx = current.indexOf(value);
        if(idx >= 0){
          current.splice(idx, 1);
        }else{
          if(value === 'none'){
            current.length = 0;
            current.push('none');
          }else{
            const noneIdx = current.indexOf('none');
            if(noneIdx >= 0) current.splice(noneIdx, 1);
            current.push(value);
          }
        }
        state[stepId] = current;
        return;
      }
      state[stepId] = value;
    }

    function getAnswer(stepId){
      return state[stepId];
    }

    function canGoNext(){
      const s = currentStep();
      const ans = getAnswer(s.id);
      if(s.type === 'multi') return Array.isArray(ans) && ans.length > 0;
      return !!ans;
    }

    function updateProgress(){
      $('stepText').textContent = `${stepIdx+1}/${steps.length}`;
      const pct = Math.round((stepIdx / (steps.length - 1)) * 100);
      $('barFill').style.width = `${pct}%`;

      $('stepHint').textContent = (currentStep().type === 'multi')
        ? 'ë³µìˆ˜ ì„ íƒ í›„ â€œë‹¤ìŒâ€'
        : 'ì„ íƒí•˜ë©´ ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°€ìš”';
    }

    function renderStep(){
      const s = currentStep();

      $('quizTitle').textContent = `Q${stepIdx+1}`;
      $('qText').textContent = `Q. ${s.title}`;   // âœ… Q. ë¶™ì´ê¸°
      $('qSub').textContent = s.sub || '';
      $('quizFootnote').textContent = s.footnote || '';

      updateProgress();

      $('btnBack').style.visibility = (stepIdx === 0) ? 'hidden' : 'visible';
      $('btnNext').style.display = (s.type === 'multi') ? 'inline-flex' : 'none';

      const opts = $('options');
      opts.innerHTML = '';
      opts.className = 'options ' + ((s.type === 'ab') ? 'two' : '');

      const selected = getAnswer(s.id);

      s.options.forEach((opt, idx)=>{
        const div = document.createElement('div');
        div.className = 'opt';

        const isSelected = (s.type === 'multi')
          ? (selected || []).includes(opt.value)
          : (selected === opt.value);

        div.dataset.selected = isSelected ? 'true' : 'false';

        // âœ… ABëŠ” ì‚¬ì§„ì²˜ëŸ¼ A./B. ë¼ë²¨ + ê°€ìš´ë° ì •ë ¬ ë°•ìŠ¤
        if(s.type === 'ab'){
          const letter = (idx === 0) ? 'A' : 'B';
          div.classList.add('abOpt');
          div.innerHTML = `
            <div class="abBadge">${letter}.</div>
            <div class="abTitle">${escapeHtml(opt.title)}</div>
            ${opt.desc ? `<div class="abDesc">${escapeHtml(opt.desc)}</div>` : ''}
          `;
        } else {
          div.innerHTML = `
            <div>
              <div class="title">${escapeHtml(opt.title)}</div>
              ${opt.desc ? `<div class="desc">${escapeHtml(opt.desc)}</div>` : ''}
            </div>
          `;
        }

        div.addEventListener('click', ()=>{
          setAnswer(s.id, opt.value);
          renderStep();
          if(s.type !== 'multi') setTimeout(()=>goNext(), 120);
        });

        opts.appendChild(div);
      });
    }

    function goNext(){
      if(!canGoNext()){
        alert('ì´ ì§ˆë¬¸ì—ì„œ í•˜ë‚˜ë¥¼ ì„ íƒí•´ì¤˜!');
        return;
      }
      if(stepIdx < steps.length - 1){
        stepIdx += 1;
        renderStep();
      }else{
        showResult();
      }
    }

    function goBack(){
      if(stepIdx > 0){
        stepIdx -= 1;
        renderStep();
      }
    }

    function resetAll(){
      clearState();
      stepIdx = 0;
      history.replaceState(null, '', location.pathname);
      showScreen('screenStart');
    }

    /* ===== ì•„ë˜ ë¡œì§(ê²°ê³¼ ìƒì„±)ì€ ë„ˆ ì½”ë“œ ê·¸ëŒ€ë¡œ ìœ ì§€ ===== */
    const profiles = {
      'ëŸ¬ë¸”ë¦¬': {
        concept: 'í•‘í¬ ë¬´ë“œ ëŸ¬ë¸”ë¦¬',
        mood: ['ë”°ëœ»', 'ì‚¬ë‘ìŠ¤ëŸ¬ì›€', 'ë¶€ë“œëŸ¬ì›€'],
        tone: 'í•‘í¬/í¬ë¦¼/ì—°í•œ ì½”ë„ ì¤‘ì‹¬',
        wrap: 'íŒŒìŠ¤í…” í¬ì¥ + ì–‡ì€ ë¦¬ë³¸(ê³¼í•˜ì§€ ì•Šê²Œ)',
        flowers: { main: ['íŠ¤ë¦½','ë¼ë„Œí˜ëŸ¬ìŠ¤','ë¦¬ì‹œì•ˆì…”ìŠ¤(ìœ ìŠ¤í† ë§ˆ)','ê±°ë² ë¼(í•‘í¬)'], sub: ['ìŠ¤í”„ë ˆì´ ì¹´ë„¤ì´ì…˜','ì•ŒìŠ¤íŠ¸ë¡œë©”ë¦¬ì•„'], texture: ['ìœ ì¹¼ë¦½íˆ¬ìŠ¤','ì™ìŠ¤í”Œë¼ì›Œ'] },
        meaning: 'â€˜ë‹¤ì •í•¨â€™ê³¼ â€˜ì„¤ë ˜â€™ ë¬´ë“œ'
      },
      'ì„¸ë ¨ë¨': {
        concept: 'ë„ì‹œì  ë¯¸ë‹ˆ ì‹œí¬',
        mood: ['ê¹”ë”', 'ì„¸ë ¨', 'ì •ëˆ'],
        tone: 'í™”ì´íŠ¸/ê·¸ë¦° + í†¤ë‹¤ìš´ í¬ì¸íŠ¸',
        wrap: 'ë¬´ê´‘ ì¢…ì´ + í†¤ë‹¤ìš´ í¬ì¥(ì •ëˆëœ ëŠë‚Œ)',
        flowers: { main: ['ë¦¬ì‹œì•ˆì…”ìŠ¤(í™”ì´íŠ¸)','ì¹´ë¼(ì¹¼ë¼)','ì•„ë„¤ëª¨ë„¤','íŠ¤ë¦½(í™”ì´íŠ¸)'], sub: ['ì•ŒìŠ¤íŠ¸ë¡œë©”ë¦¬ì•„','ìŠ¤ì¹´ë¹„ì˜¤ì‚¬'], texture: ['ìœ ì¹¼ë¦½íˆ¬ìŠ¤','ëŸ¬ìŠ¤ì»¤ìŠ¤(ê·¸ë¦°)'] },
        meaning: 'â€˜ì¡´ì¤‘â€™ê³¼ â€˜ì„¼ìŠ¤â€™ ë¬´ë“œ'
      },
      'ê·€ì—¬ì›€': {
        concept: 'ìƒí¼ ë°œë„ íŒ',
        mood: ['ë°œë„', 'ëª…ë‘', 'ê·€ì—¬ì›€'],
        tone: 'ë°ì€ ì»¬ëŸ¬(ì˜ë¡œ/í•‘í¬/ë¼ì´íŠ¸ ì˜¤ë Œì§€) 1~2ìƒ‰',
        wrap: 'ì»¬ëŸ¬ í¬ì¸íŠ¸ í¬ì¥(ê³¼í•˜ì§€ ì•Šê²Œ)',
        flowers: { main: ['ê±°ë² ë¼','íŠ¤ë¦½','ë¼ë„Œí˜ëŸ¬ìŠ¤'], sub: ['ì•ŒìŠ¤íŠ¸ë¡œë©”ë¦¬ì•„','ìŠ¤í”„ë ˆì´ ì¹´ë„¤ì´ì…˜'], texture: ['ìœ ì¹¼ë¦½íˆ¬ìŠ¤','ì™ìŠ¤í”Œë¼ì›Œ'] },
        meaning: 'â€˜ê¸°ë¶„ ì—…â€™ê³¼ â€˜ì‘ì›â€™ ë¬´ë“œ'
      },
      'ë¯¸ë‹ˆë©€': {
        concept: 'ì‹¬í”Œ ë‹´ë°± ì›í†¤',
        mood: ['ì‹¬í”Œ', 'ë‹´ë°±', 'ì°¨ë¶„'],
        tone: 'ì›í†¤(í™”ì´íŠ¸/í¬ë¦¼/ì—°í•‘í¬ ì¤‘ 1) + ê·¸ë¦° ìµœì†Œ',
        wrap: 'ë¬´ê´‘/í¬ë¼í”„íŠ¸ ê³„ì—´ + ë¦¬ë³¸ ìµœì†Œ',
        flowers: { main: ['ë¦¬ì‹œì•ˆì…”ìŠ¤(ìœ ìŠ¤í† ë§ˆ)','íŠ¤ë¦½','ì•„ë„¤ëª¨ë„¤'], sub: ['ì•ŒìŠ¤íŠ¸ë¡œë©”ë¦¬ì•„'], texture: ['ìœ ì¹¼ë¦½íˆ¬ìŠ¤','ëŸ¬ìŠ¤ì»¤ìŠ¤(ê·¸ë¦°)'] },
        meaning: 'â€˜í¸ì•ˆí•¨â€™ê³¼ â€˜ì •ì„±â€™ ë¬´ë“œ'
      },
      'ìš°ì•„í•¨': {
        concept: 'ì°¨ë¶„í•œ ê³ ê¸‰ ë¬´ë“œ',
        mood: ['ìš°ì•„', 'ì°¨ë¶„', 'ê³ ê¸‰'],
        tone: 'í¬ë¦¼/í™”ì´íŠ¸/í†¤ë‹¤ìš´ í•‘í¬ + ê·¸ë¦°',
        wrap: 'í†¤ë‹¤ìš´ í¬ì¥ + ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ë¦¬ë³¸(ê³¼í•˜ì§€ ì•Šê²Œ)',
        flowers: { main: ['ë¦¬ì‹œì•ˆì…”ìŠ¤(ìœ ìŠ¤í† ë§ˆ)','ë¼ë„Œí˜ëŸ¬ìŠ¤','íŠ¤ë¦½'], sub: ['ìŠ¤ì¹´ë¹„ì˜¤ì‚¬','ì•ŒìŠ¤íŠ¸ë¡œë©”ë¦¬ì•„'], texture: ['ìœ ì¹¼ë¦½íˆ¬ìŠ¤','ì™ìŠ¤í”Œë¼ì›Œ'] },
        meaning: 'â€˜í’ˆê²©â€™ê³¼ â€˜ì¡´ì¤‘â€™ ë¬´ë“œ'
      },
      'í™œê¸°': {
        concept: 'ë°ì€ ì—ë„ˆì§€ ì—…',
        mood: ['ì—ë„ˆì§€', 'ë°ìŒ', 'í™œê¸°'],
        tone: 'ì˜ë¡œ/ë¼ì´íŠ¸ ì˜¤ë Œì§€ + í™”ì´íŠ¸ë¡œ ì •ë¦¬',
        wrap: 'ë°ì€ í¬ì¸íŠ¸ í¬ì¥ + ê¹”ë”í•œ ë§ˆê°',
        flowers: { main: ['í•´ë°”ë¼ê¸°','ê±°ë² ë¼','íŠ¤ë¦½'], sub: ['ì•ŒìŠ¤íŠ¸ë¡œë©”ë¦¬ì•„','ìŠ¤í”„ë ˆì´ ì¹´ë„¤ì´ì…˜'], texture: ['ìœ ì¹¼ë¦½íˆ¬ìŠ¤','ëŸ¬ìŠ¤ì»¤ìŠ¤(ê·¸ë¦°)'] },
        meaning: 'â€˜ì‘ì›â€™ê³¼ â€˜ê¸°ë¶„ì „í™˜â€™ ë¬´ë“œ'
      }
    };

    const occasionReason = {
      'ìƒì¼/ê¸°ë…ì¼':'íŠ¹ë³„í•œ ë‚ ì—” ë°ê³  ì„¼ìŠ¤ ìˆëŠ” ë¬´ë“œê°€ ê°€ì¥ ì•ˆì „í•´ìš”.',
      'ìƒì¼':'ìƒì¼ì€ â€˜ì¶•í•˜â€™ê°€ ì¤‘ì‹¬. ë°ê³  ê¸°ë¶„ ì¢‹ì•„ì§€ëŠ” ë¬´ë“œê°€ ì•ˆì „í•´ìš”.',
      'ê¸°ë…ì¼':'ê¸°ë…ì¼ì€ â€˜ê´€ê³„ì˜ í™•ì‹ â€™ì´ í¬ì¸íŠ¸. ê³¼í•˜ì§€ ì•Šê²Œ ì„¼ìŠ¤ê°€ ì¢‹ì•„ìš”.',
      'ì‚¬ê³¼(ë¯¸ì•ˆí•´)':'ì‚¬ê³¼ëŠ” â€˜ë¶€ë‹´â€™ë³´ë‹¤ â€˜ì§„ì‹¬â€™. í†¤ë‹¤ìš´ + ë‹´ë°±ì´ ì œì¼ ì•ˆì •ì ì´ì—ìš”.',
      'ì¶•í•˜(í•©ê²©/ìŠ¹ì§„/ìƒˆì¶œë°œ)':'ì¶•í•˜ëŠ” â€˜ì‘ì›/ìë¶€ì‹¬â€™. ê¹”ë”í•œë° í˜ ìˆëŠ” ì¡°í•©ì´ ì¢‹ì•„ìš”.',
      'ì²« ì„ ë¬¼':'ì²« ì„ ë¬¼ì€ â€˜ì•ˆì „í•˜ê²Œ í˜¸ê°â€™. ì·¨í–¥ ì¡´ì¤‘ í†¤ì´ ë‹µì´ì—ìš”.',
      'ê·¸ëƒ¥(ê³ ë§™ê³  ì‘ì›)':'ê·¸ëƒ¥ ì£¼ëŠ” ê±´ â€˜ì¼ìƒì— ì •ì„±â€™. ë©˜íŠ¸ í•œ ì¤„ì´ë©´ ì„¼ìŠ¤ ì™„ì„±.'
    };

    function normalizeBrightness(brightness){
      if(brightness === 'bright' || brightness === 'vivid') return 'bright';
      if(brightness === 'calm' || brightness === 'soft') return 'calm';
      return 'bright';
    }

    function normalizeStyle(style){
      if(style === 'cute' || style === 'romantic' || style === 'soft_feminine') return 'cute';
      if(style === 'chic' || style === 'minimal' || style === 'elegant' || style === 'chic_elegant' || style === 'trendy') return 'chic';
      return 'chic';
    }

    function mapPersonality(brightness, style){
      const b = normalizeBrightness(brightness);
      const s = normalizeStyle(style);
      const key = `${b}|${s}`;
      const table = {
        'bright|cute':'ëŸ¬ë¸”ë¦¬',
        'bright|chic':'ì„¸ë ¨ë¨',
        'calm|chic':'ë¯¸ë‹ˆë©€',
        'calm|cute':'ëŸ¬ë¸”ë¦¬'
      };
      return table[key] || 'ì„¸ë ¨ë¨';
    }

    function pickFlowers(profile){
      const main = (profile.flowers.main || ['ë¦¬ì‹œì•ˆì…”ìŠ¤(ìœ ìŠ¤í† ë§ˆ)','íŠ¤ë¦½']).slice(0,2);
      const sub = (profile.flowers.sub || ['ì•ŒìŠ¤íŠ¸ë¡œë©”ë¦¬ì•„','ìŠ¤í”„ë ˆì´ ì¹´ë„¤ì´ì…˜']).slice(0,2);
      const tex = (profile.flowers.texture || ['ìœ ì¹¼ë¦½íˆ¬ìŠ¤','ëŸ¬ìŠ¤ì»¤ìŠ¤(ê·¸ë¦°)']).slice(0,2);
      return { main, sub, tex };
    }

    function buildMessages({relation, occasion}){
      const base = {
        'ì¸/ì†Œê°œíŒ…': {
          simple: 'ë„ˆí•œí…Œ ì–´ìš¸ë¦´ ê²ƒ ê°™ì•„ì„œ ë“¤ê³  ì™”ì–´.',
          sense: 'ë¬´ë“œê°€ ë”± ë„ˆë¼ì„œ ê³¨ë¼ë´¤ì–´ ğŸ™‚',
          sincere: 'ë¶€ë‹´ ì—†ì´ ë°›ì•„ì¤˜. ê¸°ë¶„ ì¢‹ì•„ì¡Œìœ¼ë©´!'
        },
        'ì—¬ìì¹œêµ¬(ì—°ì¸)': {
          simple: 'ë„¤ ì·¨í–¥ ìª½ìœ¼ë¡œ ì±™ê²¨ì™”ì–´.',
          sense: 'ì´ ëŠë‚Œ, ë„ˆí•œí…Œ ê½¤ ì˜ ì–´ìš¸ë¦´ ë“¯ ğŸ™‚',
          sincere: 'ìš”ì¦˜ ê³ ë§ˆìš´ ê²Œ ë§ì•„ì„œ, ì´ë ‡ê²Œ ì „í•˜ê³  ì‹¶ì—ˆì–´.'
        },
        'ì•„ë‚´/ë°°ìš°ì': {
          simple: 'ì´ê±¸ë¡œ ê³ ë§ˆì›€ ì „í• ê²Œ.',
          sense: 'ë‹¹ì‹  ìŠ¤íƒ€ì¼ë¡œ ì •ë¦¬í•´ì„œ ë¶€íƒí•´ë´¤ì–´ ğŸ™‚',
          sincere: 'ëŠ˜ ë“ ë“ í•˜ê³  ê³ ë§ˆì›Œ. ê½ƒìœ¼ë¡œ ë§ˆìŒ ì „í• ê²Œ.'
        },
        'ì¹œêµ¬/ë™ë£Œ': {
          simple: 'ìˆ˜ê³ í–ˆì–´. ì´ê±° ë°›ì•„!',
          sense: 'ìš”ì¦˜ ë¶„ìœ„ê¸°ë‘ ë§ì¶°ì„œ í”½í–ˆì–´ ğŸ™‚',
          sincere: 'ì‘ì›í•˜ëŠ” ë§ˆìŒì´ì•¼. ì˜ í’€ë¦¬ê¸¸!'
        },
        'ê°€ì¡±': {
          simple: 'ëŠ˜ ê³ ë§ˆìš´ ë§ˆìŒì´ì•¼.',
          sense: 'ê°€ì¡±ì´ë¼ ë” ë‹´ë°±í•˜ê²Œ ì±™ê²¼ì–´ ğŸ™‚',
          sincere: 'í•­ìƒ ë“ ë“ í•´ì„œ ê³ ë§ˆì›Œ. ê½ƒìœ¼ë¡œ ë§ˆìŒ ì „í• ê²Œ.'
        }
      };

      const tails = {
        'ìƒì¼/ê¸°ë…ì¼': { simple:' ì˜¤ëŠ˜ì€ íŠ¹ë³„í•œ ë‚ .', sense:' ì˜¤ëŠ˜ì€ í™•ì‹¤íˆ ì±™ê¸°ì ğŸ™‚', sincere:' ì˜¤ëŠ˜ ê¸°ì–µì´ ì˜¤ë˜ ë‚¨ì•˜ìœ¼ë©´ ì¢‹ê² ì–´.' },
        'ìƒì¼': { simple:' ì˜¤ëŠ˜ì€ ë„ˆ ì£¼ì¸ê³µ.', sense:' ë„¤ ë‚ ì´ë‹ˆê¹Œ ì±™ê²¨ì•¼ì§€ ğŸ™‚', sincere:' ì˜¬ í•œ í•´ë„ ì¢‹ì€ ì¼ë§Œ ê°€ë“í•˜ê¸¸!' },
        'ê¸°ë…ì¼': { simple:' ê·¸ëƒ¥ ë„˜ì–´ê°€ë©´ ì„­í•˜ì§€.', sense:' ê¸°ë…ì¼ì´ë¼ í™•ì‹¤íˆ ì±™ê¹€ ğŸ™‚', sincere:' ìš°ë¦¬ ì•ìœ¼ë¡œë„ ê³„ì† ì˜ ì§€ë‚´ì.' },
        'ì‚¬ê³¼(ë¯¸ì•ˆí•´)': { simple:' ë‚´ê°€ ì¢€ ë” ì‹ ê²½ ì“¸ê²Œ.', sense:' ë§ë¡œë§Œ ë§ê³  í–‰ë™ìœ¼ë¡œ ë³´ì—¬ì¤„ê²Œ ğŸ™‚', sincere:' ë¯¸ì•ˆí•´. ë§ˆìŒ í’€ë ¸ìœ¼ë©´ ì¢‹ê² ë‹¤.' },
        'ì¶•í•˜(í•©ê²©/ìŠ¹ì§„/ìƒˆì¶œë°œ)': { simple:' ì§„ì§œ ë©‹ì¡Œë‹¤.', sense:' ì´ëŸ° ë‚ ì€ ê½ƒì´ êµ­ë£° ğŸ™‚', sincere:' ì•ìœ¼ë¡œ ë” ì˜ ë  ê±°ì•¼. ì§„ì‹¬ìœ¼ë¡œ ì¶•í•˜í•´.' },
        'ì²« ì„ ë¬¼': { simple:' ì²« ê½ƒì´ë¼ ë¬´ë‚œí•˜ê²Œ ì‹œì‘!', sense:' ì²˜ìŒì´ë¼ ë” ê³ ë¯¼í–ˆì–´ ğŸ™‚', sincere:' ë¶€ë‹´ì€ ë§ê³ , ê·¸ëƒ¥ ë‚´ ë§ˆìŒì´ë¼ê³  ìƒê°í•´ì¤˜.' },
        'ê·¸ëƒ¥(ê³ ë§™ê³  ì‘ì›)': { simple:' ì´ìœ  ì—†ì–´ë„ ë˜ëŠ” ë‚ ì´ì–ì•„.', sense:' ê·¸ëƒ¥ ì£¼ê³  ì‹¶ì–´ì„œ ë“¤ê³  ì™”ì§€ ğŸ™‚', sincere:' ìš”ì¦˜ ê³ ìƒ ë§ì•„ì„œ, ê¸°ë¶„ ì „í™˜ í–ˆìœ¼ë©´!' }
      };

      const rel = base[relation] || base['ì—¬ìì¹œêµ¬(ì—°ì¸)'];
      const tail = tails[occasion] || {simple:'', sense:'', sincere:''};

      return {
        simple: rel.simple + (tail.simple || ''),
        sense: rel.sense + (tail.sense || ''),
        sincere: rel.sincere + (tail.sincere || '')
      };
    }

    function buildStoryTip({ personality, relation, occasion, tone }){
      const openerByPersonality = {
        'ëŸ¬ë¸”ë¦¬': 'ë¶€ë“œëŸ½ê³  ì‚¬ë‘ìŠ¤ëŸ¬ìš´ ë¶„ìœ„ê¸°ê°€ ë„ˆë‘ ì˜ ì–´ìš¸ë¦´ ê²ƒ ê°™ì•„ì„œ ê³¨ëì–´.',
        'ì„¸ë ¨ë¨': 'ë„ì‹œì ì´ê³  ê¹”ë”í•œ ë¬´ë“œê°€ ë„ˆë‘ ì˜ ë§ì„ ê²ƒ ê°™ì•„ì„œ ì´ ì»¨ì…‰ìœ¼ë¡œ ê³¨ëì–´.',
        'ê·€ì—¬ì›€': 'ë°ê³  ë°œë„í•œ ëŠë‚Œì´ ë„ˆí•œí…Œ ì˜ ì–´ìš¸ë¦´ ê²ƒ ê°™ì•„ì„œ ì´ë ‡ê²Œ ê³¨ëì–´.',
        'ë¯¸ë‹ˆë©€': 'ê³¼í•˜ì§€ ì•Šê²Œ ì •ëˆëœ ëŠë‚Œì´ ë” ë©‹ìˆì„ ê²ƒ ê°™ì•„ì„œ ì´ ìŠ¤íƒ€ì¼ë¡œ ê³¨ëì–´.',
        'ìš°ì•„í•¨': 'ì°¨ë¶„í•˜ê³  ìš°ì•„í•œ ë¶„ìœ„ê¸°ê°€ ë„ˆí•œí…Œ ì˜ ì–´ìš¸ë¦´ ê²ƒ ê°™ì•„ì„œ ì´ë ‡ê²Œ ì¤€ë¹„í–ˆì–´.',
        'í™œê¸°': 'ì—ë„ˆì§€ ìˆê³  í™˜í•œ ëŠë‚Œì´ ë”± ë„ˆë‹µë‹¤ê³  ìƒê°í•´ì„œ ì´ê±¸ë¡œ ê³¨ëì–´.'
      };

      const relationTail = {
        'ì¸/ì†Œê°œíŒ…': 'ë¶€ë‹´ ì—†ì´ ë°›ì•˜ìœ¼ë©´ ì¢‹ê² ê³ , ë„¤ ë°˜ì‘ì´ ê¶ê¸ˆí•´.',
        'ì—¬ìì¹œêµ¬(ì—°ì¸)': 'ë„¤ê°€ ì¢‹ì•„í•´ì£¼ë©´ ê·¸ê±¸ë¡œ ì™„ì „ ì„±ê³µì´ì•¼.',
        'ì•„ë‚´/ë°°ìš°ì': 'ëŠ˜ ê³ ë§ˆìš´ ë§ˆìŒì„ ì´ë ‡ê²Œë¼ë„ ì „í•˜ê³  ì‹¶ì—ˆì–´.',
        'ì¹œêµ¬/ë™ë£Œ': 'ë„ˆë‹µê²Œ ì˜ ì–´ìš¸ë¦¬ë©´ ì§„ì§œ ë¿Œë“¯í•  ê²ƒ ê°™ì•„.',
        'ê°€ì¡±': 'ê°€ì¡±ì´ë¼ ë” ë”°ëœ»í•˜ê²Œ ì „í•˜ê³  ì‹¶ì—ˆì–´.'
      };

      const occasionTail = {
        'ìƒì¼/ê¸°ë…ì¼': 'ì˜¤ëŠ˜ ê°™ì€ íŠ¹ë³„í•œ ë‚ ì´ë¼ ë” ì‹ ê²½ ì¨ì„œ ê³¨ëì–´.',
        'ìƒì¼': 'ì˜¤ëŠ˜ í•˜ë£¨ ê¸°ë¶„ ì¢‹ê²Œ ê¸°ì–µëìœ¼ë©´ ì¢‹ê² ì–´.',
        'ê¸°ë…ì¼': 'ìš°ë¦¬í•œí…Œ ì˜ë¯¸ ìˆëŠ” ë‚ ì´ë¼ ë” ì‹ ê²½ ì¨ì„œ ê³¨ëì–´.',
        'ì‚¬ê³¼(ë¯¸ì•ˆí•´)': 'ë§ë³´ë‹¤ ì§„ì‹¬ì´ ë¨¼ì € ì „ë‹¬ëìœ¼ë©´ ì¢‹ê² ì–´.',
        'ì¶•í•˜(í•©ê²©/ìŠ¹ì§„/ìƒˆì¶œë°œ)': 'ì§„ì‹¬ìœ¼ë¡œ ì¶•í•˜í•˜ê³ , ì‹œì‘ì´ ë” ë¹›ë‚¬ìœ¼ë©´ ì¢‹ê² ì–´.',
        'ì²« ì„ ë¬¼': 'ì²« ê½ƒ ì„ ë¬¼ì´ë¼ ë” ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ê³ ë¥¸ ê±°ì•¼.',
        'ê·¸ëƒ¥(ê³ ë§™ê³  ì‘ì›)': 'íŠ¹ë³„í•œ ì´ìœ  ì—†ì–´ë„ ê³ ë§ˆìš´ ë§ˆìŒì€ ì „í•˜ê³  ì‹¶ì—ˆì–´.'
      };

      const opener = openerByPersonality[personality] || openerByPersonality['ì„¸ë ¨ë¨'];
      const rel = relationTail[relation] || 'ì˜ ì–´ìš¸ë¦¬ë©´ ì¢‹ê² ë‹¤ëŠ” ë§ˆìŒìœ¼ë¡œ ê³¨ëì–´.';
      const occ = occasionTail[occasion] || '';

      return `ì¶”ì²œ ë©˜íŠ¸: "${opener} ${tone} í†¤ìœ¼ë¡œ ë§ì¶”ë©´ â€˜ì¡´ì¤‘â€™ê³¼ â€˜ì„¼ìŠ¤â€™ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ì „ë‹¬ëœë‹¤ê³  í•˜ë”ë¼. ${occ} ${rel}"`;
    }

    function hexToRgb(hex){
      const h = (hex || '').replace('#','');
      if(h.length !== 6) return null;
      const r = parseInt(h.slice(0,2),16);
      const g = parseInt(h.slice(2,4),16);
      const b = parseInt(h.slice(4,6),16);
      if(Number.isNaN(r) || Number.isNaN(g) || Number.isNaN(b)) return null;
      return { r, g, b };
    }

    function rgbToSaturation({r,g,b}){
      const rf = r/255, gf = g/255, bf = b/255;
      const max = Math.max(rf,gf,bf);
      const min = Math.min(rf,gf,bf);
      const l = (max + min) / 2;
      if(max === min) return 0;
      const d = max - min;
      return l > 0.5 ? d / (2 - max - min) : d / (max + min);
    }

    function pickMostSaturatedHex(palette){
      let best = { hex:'#166534', sat:-1 };
      (palette || []).forEach(p => {
        const rgb = hexToRgb(p.hex);
        if(!rgb) return;
        const sat = rgbToSaturation(rgb);
        if(sat > best.sat) best = { hex:p.hex, sat };
      });
      return best.hex;
    }

    /* ===== FREE ëŒ€í‘œ ê½ƒ 1ì†¡ì´ ì´ë¯¸ì§€ ë§¤í•‘ (ë„ˆ ë ˆí¬ ê²½ë¡œ/íŒŒì¼ëª… ê¸°ì¤€) ===== */
    const mainFlowerByPersonality = {
      'ëŸ¬ë¸”ë¦¬': { name: 'ë¼ë„Œí˜ëŸ¬ìŠ¤', img: 'image/ranunculus.png' },
      'ê·€ì—¬ì›€': { name: 'ê±°ë² ë¼', img: 'image/gerbera.png' },
      'í™œê¸°':   { name: 'íŠ¤ë¦½', img: 'image/tulip.png' },
      'ì„¸ë ¨ë¨': { name: 'ì¹´ë¼(ì¹¼ë¼)', img: 'image/calla.png' },
      'ë¯¸ë‹ˆë©€': { name: 'ë¦¬ì‹œì•ˆì…”ìŠ¤', img: 'image/lisianthus.png' },
      'ìš°ì•„í•¨': { name: 'ì¥ë¯¸', img: 'image/rose.png' }
    };

    function getMainFlowerAsset(personality){
      return mainFlowerByPersonality[personality] || { name:'íŠ¤ë¦½', img:'image/tulip.png' };
    }

    /* ===== PRO ë°ëª¨ ì ê¸ˆ/í•´ì œ ===== */
    function isProUnlocked(){
      try{
        const params = new URLSearchParams(location.search);
        if(params.get('pro') === '1') return true;   // ì‹œì—°ìš©
        return localStorage.getItem('pro_unlocked') === '1';
      }catch(e){
        return false;
      }
    }
    function setProUnlocked(v){
      try{
        localStorage.setItem('pro_unlocked', v ? '1' : '0');
      }catch(e){}
    }

    /* ===== ë‹¤ìš´ë¡œë“œ: TXT ===== */
    function downloadTextFile(filename, text){
      const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=> URL.revokeObjectURL(url), 1000);
    }

    /* ===== ë‹¤ìš´ë¡œë“œ: PNG(ì£¼ë¬¸ì„œ ì´ë¯¸ì§€) ===== */
    function wrapCanvasText(ctx, text, x, y, maxWidth, lineHeight){
      const words = text.split(' ');
      let line = '';
      for(let n=0; n<words.length; n++){
        const testLine = line + words[n] + ' ';
        const metrics = ctx.measureText(testLine);
        if(metrics.width > maxWidth && n > 0){
          ctx.fillText(line.trim(), x, y);
          line = words[n] + ' ';
          y += lineHeight;
        }else{
          line = testLine;
        }
      }
      ctx.fillText(line.trim(), x, y);
      return y + lineHeight;
    }

    async function downloadOrderSheetPng({ title, subtitle, lines }){
      const W = 1080, H = 1350;
      const canvas = document.createElement('canvas');
      canvas.width = W; canvas.height = H;
      const ctx = canvas.getContext('2d');

      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0,0,W,H);

      ctx.fillStyle = '#22c55e';
      ctx.fillRect(0,0,W,160);

      ctx.fillStyle = '#ffffff';
      ctx.font = '900 54px ui-sans-serif, system-ui, -apple-system';
      ctx.fillText(title || 'ê½ƒ ì£¼ë¬¸ì„œ', 60, 95);

      ctx.font = '700 28px ui-sans-serif, system-ui, -apple-system';
      ctx.fillText(subtitle || '', 60, 135);

      let y = 220;
      ctx.fillStyle = '#0f172a';
      ctx.font = '800 30px ui-sans-serif, system-ui, -apple-system';
      ctx.fillText('ë³µë¶™í•´ì„œ ê½ƒì§‘ì— ë³´ë‚´ì„¸ìš”', 60, y);

      y += 48;
      ctx.strokeStyle = '#e5e7eb';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(60, y);
      ctx.lineTo(W-60, y);
      ctx.stroke();

      y += 36;
      ctx.font = '650 30px ui-sans-serif, system-ui, -apple-system';

      const maxWidth = W - 120;
      const lineHeight = 44;

      for(const line of lines){
        y = wrapCanvasText(ctx, line, 60, y, maxWidth, lineHeight);
        if(y > H - 120) break;
      }

      ctx.fillStyle = '#64748b';
      ctx.font = '700 24px ui-sans-serif, system-ui, -apple-system';
      ctx.fillText('Â© TONE ART / flowerproject', 60, H - 60);

      const dataUrl = canvas.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = dataUrl;
      a.download = 'order_sheet.png';
      document.body.appendChild(a);
      a.click();
      a.remove();
    }

    function showResult(){
      const personality = mapPersonality(state.brightness, state.style);
      const profile = profiles[personality];

      const { main, sub, tex } = pickFlowers(profile);
      const msgs = buildMessages({relation: state.relation, occasion: state.occasion});

      let tone = profile.tone;
      let wrap = profile.wrap;
      const finishHintByValue = {
        'ê¹”ë” ë§ˆê°':'ì¢…ì´ 1~2ê²¹, ë¦¬ë³¸ ìµœì†Œ',
        'í¬ì¸íŠ¸ ë§ˆê°':'í¬ì¸íŠ¸ ì»¬ëŸ¬ ê°•ì¡°',
        'ê³ ê¸‰ ë§ˆê°':'í†¤ë‹¤ìš´, ë¬´ê´‘ ì¬ì§ˆ',
        'ëŸ¬ë¸”ë¦¬ ë§ˆê°':'ë¶€ë“œëŸ¬ìš´ ìƒ‰ê° + ë¦¬ë³¸ ê°•ì¡°'
      };
      const finishHint = finishHintByValue[state.finish];
      if(finishHint) wrap += ` / ${finishHint}`;

      const photoFinishHintByValue = {
        sns_often:'í¬ì¸íŠ¸ ì»¬ëŸ¬ + ì‚¬ì§„ë¹¨ ë§ˆê°',
        sns_sometimes:'í¬ì¸íŠ¸ or ê³ ê¸‰ ë§ˆê°',
        private_photo:'ê³ ê¸‰/ê¹”ë” ë§ˆê°',
        no_photo:'ê¹”ë” ë§ˆê°'
      };
      const photoFinishHint = (!state.finish && state.photoHabit) ? photoFinishHintByValue[state.photoHabit] : '';
      if(photoFinishHint) wrap += ` / ${photoFinishHint}`;

      const styleLabel = {
        cute:'ê·€ì—¬ì›€',
        chic:'ì„¸ë ¨/ìš°ì•„',
        romantic:'ëŸ¬ë¸”ë¦¬',
        minimal:'ë¯¸ë‹ˆë©€',
        soft_feminine:'ì²­ìˆœ',
        chic_elegant:'ì„¸ë ¨/ìš°ì•„',
        trendy:'íŠ¸ë Œë””/í™'
      }[state.style] || 'ì„¸ë ¨/ìš°ì•„';

      const paletteLabel = {
        white_green:'í™”ì´íŠ¸Â·ê·¸ë¦°',
        pink_peach:'í•‘í¬Â·í”¼ì¹˜',
        lilac:'ì—°ë³´ë¼Â·ë¼ì¼ë½',
        red_wine:'ë ˆë“œÂ·ë²„ê±´ë””',
        yellow_orange:'ì˜ë¡œÂ·ì˜¤ë Œì§€'
      }[state.palette] || 'ë¯¸ì„ íƒ';

      const photoHabitLabel = {
        sns_often:'SNS ìì£¼',
        sns_sometimes:'ê°€ë” ì—…ë¡œë“œ',
        private_photo:'ì°ê³  ë³´ê´€',
        no_photo:'ì‚¬ì§„ ê´€ì‹¬ ì—†ìŒ'
      }[state.photoHabit] || 'ë¯¸ì„ íƒ';

      const cautionLabel = {
        scent_light:'í–¥ì€ ì•½í•œ ìª½ì´ ì¢‹ì•„ìš”',
        allergy_sensitive:'ì•Œë ˆë¥´ê¸°/ë¯¼ê°(ê½ƒê°€ë£¨/í–¥ ìµœì†Œ)',
        no_rose:'ì¥ë¯¸ëŠ” ë‹¤ë¥¸ ê½ƒì´ë©´ ë” ì¢‹ì•„ìš”',
        clean_over_flashy:'í™”ë ¤í•¨ë³´ë‹¨ ê¹”ë”í•œ ê²Œ ì¢‹ì•„ìš”',
        none:'ì—†ìŒ'
      };
      const cautionValues = (state.cautions || []).filter(v => v !== 'none');
      const cautionText = cautionValues.map(v => cautionLabel[v] || v).join(', ');

      const personalitySentence = (() => {
        const adj = {
          'ëŸ¬ë¸”ë¦¬':'ë¶€ë“œëŸ½ê³  ì‚¬ë‘ìŠ¤ëŸ¬ìš´',
          'ì„¸ë ¨ë¨':'ë„ì‹œì ì´ê³  ê¹”ë”í•œ',
          'ê·€ì—¬ì›€':'ë°œë„í•˜ê³  ê·€ì—¬ìš´',
          'ë¯¸ë‹ˆë©€':'ë‹´ë°±í•˜ê³  ì ˆì œëœ',
          'ìš°ì•„í•¨':'ì°¨ë¶„í•˜ê³  ìš°ì•„í•œ',
          'í™œê¸°':'ì—ë„ˆì§€ ë„˜ì¹˜ëŠ”'
        }[personality] || 'ê¹”ë”í•œ';
        return `${adj} ê·¸ë…€ì—ê² ${styleLabel} ìŠ¤íƒ€ì¼ì„ ì¶”ì²œë“œë ¤ìš”.`;
      })();

      const reasonParts = [
        `ê´€ê³„: ${state.relation || 'ë¯¸ì„ íƒ'}`,
        `ìƒí™©: ${state.occasion || 'ë¯¸ì„ íƒ'}`,
        state.palette ? `ìƒ‰ê°: ${paletteLabel}` : '',
        state.finish ? `ë§ˆë¬´ë¦¬: ${state.finish}` : '',
        state.photoHabit ? `ì‚¬ì§„ ìŠµê´€: ${photoHabitLabel}` : '',
        cautionText ? `ì°¸ê³ ì‚¬í•­: ${cautionText}` : '',
        occasionReason[state.occasion] || '',
        `ì„ íƒí•œ ë¬´ë“œëŠ” â€œ${styleLabel}${state.palette ? ` / ${paletteLabel}` : ''}${state.photoHabit ? ` / ${photoHabitLabel}` : ''}â€ ìª½!`
      ].filter(Boolean);

      const meaning = `${profile.meaning} (ìƒí™©: ${state.occasion || 'ë¯¸ì„ íƒ'})`;
      const substitution = 'ë©”ì¸ ê½ƒ í’ˆì ˆ ì‹œ ë¹„ìŠ·í•œ í†¤/ê²°ë¡œ ëŒ€ì²´ ê°€ëŠ¥(ë¬´ë“œ ìœ ì§€).';
      const palette = paletteByPersonality[personality] || paletteByPersonality['ì„¸ë ¨ë¨'];
      const pickTitleColor = pickMostSaturatedHex(palette);
      const sampleImage = pickConceptPreviewPhoto(personality);
      const conceptFlowerName = pickConceptFlowerName(personality);
      const sampleImageFallback = pickFlowerPhoto(main) || fallbackSampleImage(profile.concept);
      const sampleImageFallbackFinal = fallbackSampleImage(profile.concept);
      const floristOrder = `í™”ì´íŠ¸+ê·¸ë¦° í†¤ì˜ ë¯¸ë‹ˆë©€ ë¶€ì¼€ë¡œ ë¶€íƒë“œë ¤ìš”.${state.finish ? ` ë§ˆë¬´ë¦¬ëŠ” ${state.finish} ëŠë‚Œìœ¼ë¡œ ë¶€íƒë“œë ¤ìš”.` : ''}${cautionText ? ` ì°¸ê³ ì‚¬í•­: ${cautionText}.` : ''} ë©”ì¸ ê½ƒ í’ˆì ˆì´ë©´ ë¹„ìŠ·í•œ í†¤ìœ¼ë¡œ ëŒ€ì²´ ê°€ëŠ¥.`;
      const shareForGirlfriend = 'ë‚´ ë‚¨ì¹œ ì•Œê³ ë¦¬ì¦˜ì— ì´ê±° ë– ë¼ ã…‹ã…‹';
      const storyTip = buildStoryTip({
        personality,
        relation: state.relation,
        occasion: state.occasion,
        tone
      });

      const shareState = {...state};
      const code = base64UrlEncode(shareState);
      const url = new URL(location.href);
      url.searchParams.set('r', code);
      history.replaceState(null, '', url.toString());

      const resultHtml = `
        <div class="box">
          <h3>ì¶”ì²œ ì»¨ì…‰</h3>
          <div class="samplePhoto">
            <div class="title">ì»¨ì…‰ ëŒ€í‘œ ê½ƒ: ${escapeHtml(personality)} ë¬´ë“œ Â· ${escapeHtml(conceptFlowerName)}</div>
            <img
              src="${escapeHtml(sampleImage)}"
              alt="${escapeHtml(profile.concept)} ìƒ˜í”Œ ì‚¬ì§„"
              loading="lazy"
              referrerpolicy="no-referrer"
              onerror="if(!this.dataset.err1){this.dataset.err1='1';this.src='${escapeHtml(sampleImageFallback)}';}else{this.onerror=null;this.src='${escapeHtml(sampleImageFallbackFinal)}';}"
            />
            <div class="cap">ìœ„ ê½ƒì€ ë©”ì¸ìœ¼ë¡œ ì¶”ì²œë“œë ¤ìš”.</div>
          </div>
          <div class="hero" style="margin-top:10px;">
            <div style="font-size:24px; font-weight:900; color:${escapeHtml(pickTitleColor)}; margin-bottom:6px;">ê½ƒì§‘ ëˆ„ë‚˜ PICK</div>
            <div class="mini">ê²°ê³¼ ì„±í–¥: <b>${escapeHtml(personalitySentence)}</b></div>
          </div>
          <div class="palette">
            ${palette.map(p => `
              <div class="swatch">
                <div class="swatchColor" style="background:${escapeHtml(p.hex)};"></div>
                <div class="swatchMeta">${escapeHtml(p.name)}<br/>${escapeHtml(p.hex)}</div>
              </div>
            `).join('')}
          </div>
        </div>

        <div class="box">
          <h3>ì°¸ê³ ì‚¬í•­</h3>
          <p style="margin:0; font-size:14px; font-weight:800; color:var(--text);">
            ${escapeHtml(cautionText || 'ì—†ìŒ')}
          </p>
          <div class="footnote">â€» ê½ƒì§‘ì— ì „ë‹¬í•  ë•Œ ë¯¸ë¦¬ ì•Œë ¤ì£¼ë©´ ì•ˆì „í•´ìš”.</div>
        </div>

        <div class="box">
          <h3>ì¶”ì²œ ê½ƒ ì¡°í•© <span class="muted" style="font-size:12px;">(ê³„ì ˆ/ì¬ê³ ì— ë”°ë¼ ë³€ê²½ ê°€ëŠ¥)</span></h3>
          <ul class="list">
            <li><b>ë©”ì¸</b>: ${main.map(escapeHtml).join(' / ')}</li>
            <li><b>ì„œë¸Œ</b>: ${sub.map(escapeHtml).join(' / ')}</li>
            <li><b>ì§ˆê°/ê·¸ë¦°</b>: ${tex.map(escapeHtml).join(' / ')}</li>
          </ul>
          <div class="divider"></div>
          <div class="muted" style="font-size:13px;"><b>ëŒ€ì²´ ê·œì¹™</b>: ${escapeHtml(substitution)}</div>
        </div>

        <div class="box">
          <div class="chips">
            <span class="chip">ì»¨ì…‰: <b>${escapeHtml(profile.concept)}</b></span>
            ${profile.mood.map(m => `<span class="chip">${escapeHtml(m)}</span>`).join('')}
          </div>
          <div class="divider"></div>
          <div class="muted" style="font-size:13px;">
            í†¤/ìƒ‰ê°: <b>${escapeHtml(tone)}</b><br/>
            í¬ì¥: <b>${escapeHtml(wrap)}</b>
          </div>
        </div>

        <div class="box">
          <div class="top3">
            <div class="topItem">
              âœ… ì˜ˆìƒ ê°€ê²©ëŒ€: ì•½ 3ë§Œ~5ë§Œì›
              <small>ì§€ì—­/ì‹œì¦Œ/ê½ƒê°’ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”.</small>
              <div class="priceRow">
                <span class="priceBadge">í•œì†¡ì´(1 flower): ì•½ 1ë§Œ~2ë§Œì›</span>
                <span class="priceBadge">ë¯¸ë‹ˆ(S): ì•½ 3ë§Œ~5ë§Œì›</span>
                <span class="priceBadge">ê¸°ë³¸(M): ì•½ 5ë§Œ~8ë§Œì›</span>
                <span class="priceBadge">í’ì„±(L): ì•½ 8ë§Œ~13ë§Œì›</span>
              </div>
            </div>
            <div class="topItem">
              âœ… ë°”ë¡œ ì£¼ë¬¸: ê½ƒì§‘ì— ë³´ë‚´ê¸°
              <small>ë²„íŠ¼ ëˆ„ë¥´ë©´ ì£¼ë¬¸ ë¬¸ì¥ì„ ë³µì‚¬í•´ì¤˜ìš”.</small>
              <div class="btnrow" style="margin-top:8px;">
                <button id="btnCopyOrder">ê½ƒì§‘ì— ë³´ë‚´ê¸°(ì£¼ë¬¸ë¬¸ì¥ ë³µì‚¬)</button>
              </div>
            </div>
          </div>
        </div>
        <div class="box">
          <h3>ì™œ ì´ê²Œ ë§ëƒë©´</h3>
          <details class="explain">
            <summary>ì ‘ê¸°/í¼ì¹˜ê¸°</summary>
            <p>${reasonParts.map(escapeHtml).join(' ')}</p>
          </details>
        </div>

        <div class="box">
          <h3>ê½ƒ ì˜ë¯¸ í•œ ì¤„</h3>
          <p style="margin:0; font-size:14px;"><b>${escapeHtml(meaning)}</b></p>
          <div class="footnote">â€» ê½ƒë§ì€ í•´ì„ì´ ì—¬ëŸ¬ ê°€ì§€ì¼ ìˆ˜ ìˆì–´ìš”.</div>
        </div>

        <div class="box">
          <h3>ê½ƒì§‘ DMìš© ì£¼ë¬¸ë¬¸ì¥(ë¬´ë£Œ 1ê°œ)</h3>
          <p style="margin:0; font-size:13px; font-weight:700;">${escapeHtml(floristOrder)}</p>
          <div class="btnrow">
            <button class="secondary" id="btnCopyOrderInline">ì£¼ë¬¸ë¬¸ì¥ ë³µì‚¬</button>
          </div>
        </div>

        <div class="box">
          <h3>ì„ ë¬¼ ìŠ¤í† ë¦¬/ì „ë‹¬ ë©”ì‹œì§€ íŒ</h3>
          <p style="margin:0; font-size:13px; font-weight:700; color:var(--text);">${escapeHtml(storyTip)}</p>
          <div class="btnrow">
            <button class="secondary" id="btnCopyStoryTip">ìŠ¤í† ë¦¬ ë©˜íŠ¸ ë³µì‚¬</button>
          </div>
        </div>

        <div class="box">
          <h3>ë°”ë¡œ ì¨ë¨¹ëŠ” ë©˜íŠ¸ 3ê°œ</h3>
          <ol class="list">
            <li>${escapeHtml(msgs.simple)}</li>
            <li>${escapeHtml(msgs.sense)}</li>
            <li>${escapeHtml(msgs.sincere)}</li>
          </ol>
          <div class="btnrow">
            <button class="secondary" id="btnCopyMent">ë©˜íŠ¸ 3ê°œ ë³µì‚¬</button>
            <button class="secondary" id="btnCopyLink">ê²°ê³¼ ë§í¬ ë³µì‚¬</button>
            <button class="secondary" id="btnCopyShareForHer">ì—¬ì¹œí•œí…Œ ê³µìœ ë¬¸êµ¬ ë³µì‚¬</button>
          </div>
          <div class="footnote">ê³µìœ  ë¬¸êµ¬ ì˜ˆ: â€œì´ê±° í•´ë³´ê³  ê½ƒ ê³¨ë¼ì¤˜ ğŸ˜‚â€ (ì¶œì²˜ ì—†ìŒ)</div>
        </div>

        <div class="box ctaPro">
          <h3>PRO(ì˜ˆì •): ê½ƒì§‘ DM ì£¼ë¬¸ì„œ + ë©˜íŠ¸ 10ê°œ</h3>
          <p class="muted" style="margin:0; font-size:13px;">
            ë‹¤ìŒ ë‹¨ê³„ëŠ” â€œê½ƒì§‘ì— ê·¸ëŒ€ë¡œ ë³´ë‚´ë©´ ì œì‘ë˜ëŠ” ì£¼ë¬¸ì„œâ€ê¹Œì§€ ë½‘ì•„ì£¼ëŠ” ê±°ì•¼.
          </p>
        </div>

        <div class="btnrow" style="margin-top:16px;">
          <button id="btnAgain">ë‹¤ì‹œ í•˜ê¸°</button>
          <button class="secondary" id="btnHome">ì²˜ìŒìœ¼ë¡œ</button>
        </div>
      `;

      $('resultArea').innerHTML = resultHtml;

      $('btnCopyMent').onclick = async ()=>{
        const text = [msgs.simple, msgs.sense, msgs.sincere].join('\n');
        const ok = await copyText(text);
        toast(ok ? 'ë©˜íŠ¸ë¥¼ ë³µì‚¬í–ˆì–´!' : 'ë³µì‚¬ ì‹¤íŒ¨(ë¸Œë¼ìš°ì € ê¶Œí•œ í™•ì¸)');
      };
      $('btnCopyOrder').onclick = async ()=>{
        const ok = await copyText(floristOrder);
        toast(ok ? 'ì£¼ë¬¸ë¬¸ì¥ì„ ë³µì‚¬í–ˆì–´!' : 'ë³µì‚¬ ì‹¤íŒ¨(ë¸Œë¼ìš°ì € ê¶Œí•œ í™•ì¸)');
      };
      $('btnCopyOrderInline').onclick = async ()=>{
        const ok = await copyText(floristOrder);
        toast(ok ? 'ì£¼ë¬¸ë¬¸ì¥ì„ ë³µì‚¬í–ˆì–´!' : 'ë³µì‚¬ ì‹¤íŒ¨(ë¸Œë¼ìš°ì € ê¶Œí•œ í™•ì¸)');
      };

      $('btnCopyLink').onclick = async ()=>{
        const shareText = `ê½ƒì„ ë§Œì§€ëŠ” ëˆ„ë‚˜ ê²°ê³¼ ë§í¬: ${url.toString()}`;
        const ok = await copyText(shareText);
        toast(ok ? 'ê²°ê³¼ ë§í¬ë¥¼ ë³µì‚¬í–ˆì–´!' : 'ë³µì‚¬ ì‹¤íŒ¨(ë¸Œë¼ìš°ì € ê¶Œí•œ í™•ì¸)');
      };
      $('btnCopyStoryTip').onclick = async ()=>{
        const ok = await copyText(storyTip);
        toast(ok ? 'ìŠ¤í† ë¦¬ ë©˜íŠ¸ë¥¼ ë³µì‚¬í–ˆì–´!' : 'ë³µì‚¬ ì‹¤íŒ¨(ë¸Œë¼ìš°ì € ê¶Œí•œ í™•ì¸)');
      };
      $('btnCopyShareForHer').onclick = async ()=>{
        const ok = await copyText(shareForGirlfriend);
        toast(ok ? 'ê³µìœ ë¬¸êµ¬ë¥¼ ë³µì‚¬í–ˆì–´!' : 'ë³µì‚¬ ì‹¤íŒ¨(ë¸Œë¼ìš°ì € ê¶Œí•œ í™•ì¸)');
      };

      $('btnAgain').onclick = ()=>{
        clearState();
        stepIdx = 0;
        showScreen('screenQuiz');
        renderStep();
      };

      $('btnHome').onclick = resetAll;

      showScreen('screenResult');
    }

    $('btnStart').addEventListener('click', ()=>{
      showScreen('screenQuiz');
      renderStep();
    });
    $('btnShareSite').addEventListener('click', async ()=>{
      const shareUrl = `${location.origin}${location.pathname}`;
      const shareText = `ë‚¨ì¹œì—ê²Œ ë³´ë‚´ê¸°(ë§í¬ ë³µì‚¬): ${shareUrl}`;

      if (navigator.share) {
        try{
          await navigator.share({
            title: 'ê½ƒì„ ë§Œì§€ëŠ” ëˆ„ë‚˜',
            text: 'ë‚¨ì¹œì—ê²Œ ë³´ë‚´ê¸°(ë§í¬ ë³µì‚¬)',
            url: shareUrl
          });
          toast('ê³µìœ ì°½ì„ ì—´ì—ˆì–´!');
          return;
        }catch(e){
          if (e && e.name === 'AbortError') return;
        }
      }

      const ok = await copyText(shareText);
      toast(ok ? 'ê³µìœ  ë¬¸êµ¬ë¥¼ ë³µì‚¬í–ˆì–´!' : 'ë³µì‚¬ ì‹¤íŒ¨(ë¸Œë¼ìš°ì € ê¶Œí•œ í™•ì¸)');
    });

    const btnLoadExample = $('btnLoadExample');
    if(btnLoadExample){
      btnLoadExample.addEventListener('click', ()=>{
        state.relation = 'ì—¬ìì¹œêµ¬(ì—°ì¸)';
        state.occasion = 'ìƒì¼/ê¸°ë…ì¼';
        state.palette = 'white_green';
        state.photoHabit = 'sns_sometimes';
        state.style = 'chic_elegant';
        state.cautions = ['none'];
        showResult();
      });
    }

    $('btnBack').addEventListener('click', goBack);
    $('btnNext').addEventListener('click', goNext);
    $('btnRestart').addEventListener('click', resetAll);

    (function initFromUrl(){
      const params = new URLSearchParams(location.search);
      const r = params.get('r');
      if(!r) return;

      try{
        const loaded = base64UrlDecode(r);
        const safeLoaded = sanitizeLoadedState(loaded);
        Object.assign(state, safeLoaded);
        showResult();
      }catch(e){
        history.replaceState(null, '', location.pathname);
      }
    })();

    initTopInfoPanel();
    initStartSlider();
  </script>
</body>
</html>
